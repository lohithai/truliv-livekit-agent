# Caddy reverse proxy configuration for LiveKit
# Handles TLS certificates automatically via Let's Encrypt

logging:
  logs:
    default:
      level: INFO

storage:
  "module": "file_system"
  "root": "/data/caddy"

apps:
  tls:
    certificates:
      automate:
        - livekit.truliv.supercx.co
        - turn.truliv.supercx.co
  layer4:
    servers:
      main:
        listen:
          - ":443"
        routes:
          - match:
              - tls:
                  sni:
                    - "turn.truliv.supercx.co"
            handle:
              - handler: tls
              - handler: proxy
                upstreams:
                  - dial:
                      - "localhost:5349"
          - match:
              - tls:
                  sni:
                    - "livekit.truliv.supercx.co"
            handle:
              - handler: tls
                connection_policies:
                  - alpn:
                      - http/1.1
                      - h2
              - handler: proxy
                upstreams:
                  - dial:
                      - "localhost:7880"
  http:
    servers:
      main:
        listen:
          - ":80"
        routes:
          - handle:
              - handler: static_response
                status_code: 301
                headers:
                  Location:
                    - "https://{http.request.host}{http.request.uri}"
